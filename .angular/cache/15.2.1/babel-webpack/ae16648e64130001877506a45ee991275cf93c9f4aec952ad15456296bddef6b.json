{"ast":null,"code":"import _asyncToGenerator from \"/home/olivio-gits/programacionIV/Peliculas/peliculas/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { __decorate } from \"tslib\";\nimport { Injectable } from '@angular/core';\nimport { BehaviorSubject } from 'rxjs';\nimport firebase from 'firebase/compat/app';\nimport 'firebase/compat/auth';\nimport { firebaseConfig } from 'src/environments/firebaseConfig';\nlet DataServiceService = class DataServiceService {\n  constructor(http,\n  //requests\n  afAuth) {\n    this.http = http;\n    this.afAuth = afAuth;\n    this.initialState = {\n      peliculas: [],\n      user: {}\n    };\n    this.stateSubject = new BehaviorSubject(this.initialState); //definimos nuestro stateSubject\n    this.state$ = this.stateSubject.asObservable();\n    firebase.initializeApp(firebaseConfig.firebase);\n  }\n  ngOnInit() {}\n  // async checkAuth() {\n  //   console.log('Check')\n  //   const token = localStorage.getItem('authToken');\n  //   console.log(token)\n  //   if (token) {\n  //     try {\n  //       const userCredential = await firebase.auth().signInWithCustomToken(token);\n  //       const user = userCredential.user;\n  //       const obj: User = {\n  //         name: user?.displayName,\n  //         email: user?.email,\n  //         image: user?.photoURL,\n  //       }\n  //       const currentState = this.stateSubject.value;\n  //       this.stateSubject.next({\n  //         ...currentState,\n  //         user:{\n  //           user: obj,\n  //           token: token\n  //         }\n  //       });\n  //     } catch (error) {\n  //       console.log('Error en la autenticaci칩n autom치tica', error);\n  //     }\n  //   }\n  // }\n  signInWithGoogle() {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      let obj;\n      const currentState = _this.stateSubject.value;\n      const provider = new firebase.auth.GoogleAuthProvider();\n      _this.afAuth.signInWithPopup(provider).then( /*#__PURE__*/function () {\n        var _ref = _asyncToGenerator(function* (result) {\n          console.log(result.user);\n          const token = result.user._delegate.stsTokenManager.accessToken; //recuperar token\n          if (result.user) {\n            obj = {\n              name: result.user.displayName,\n              email: result.user.email,\n              image: result.user.photoURL\n            };\n            yield localStorage.setItem('authToken', token); //guardar mi token\n            _this.stateSubject.next({\n              ...currentState,\n              user: {\n                user: obj,\n                token: token\n              }\n            });\n          }\n        });\n        return function (_x) {\n          return _ref.apply(this, arguments);\n        };\n      }());\n    })();\n  }\n  signOut() {\n    var _this2 = this;\n    return _asyncToGenerator(function* () {\n      const currentState = _this2.stateSubject.value;\n      yield _this2.afAuth.signOut();\n      // Eliminar token de localStorage y propiedad user del servicio\n      localStorage.removeItem('authToken');\n      _this2.stateSubject.next({\n        ...currentState,\n        user: {\n          user: 'null',\n          token: 'null'\n        }\n      });\n    })();\n  }\n};\nDataServiceService = __decorate([Injectable({\n  providedIn: 'root'\n})], DataServiceService);\nexport { DataServiceService };","map":{"version":3,"mappings":";;AAAA,SAASA,UAAU,QAAgB,eAAe;AAClD,SAASC,eAAe,QAAQ,MAAM;AACtC,OAAOC,QAAQ,MAAM,qBAAqB;AAC1C,OAAO,sBAAsB;AAI7B,SAASC,cAAc,QAAQ,iCAAiC;AAIzD,IAAMC,kBAAkB,GAAxB,MAAMA,kBAAkB;EAE7BC,YACUC,IAAe;EAAE;EACjBC,MAAuB;IADvB,SAAI,GAAJD,IAAI;IACJ,WAAM,GAANC,MAAM;IAKR,iBAAY,GAAa;MAC/BC,SAAS,EAAC,EAAE;MACZC,IAAI,EAAC;KACN;IACO,iBAAY,GAAG,IAAIR,eAAe,CAAc,IAAI,CAACS,YAAY,CAAC,CAAC,CAAC;IAC5E,WAAM,GAAG,IAAI,CAACC,YAAY,CAACC,YAAY,EAAE;IARvCV,QAAQ,CAACW,aAAa,CAACV,cAAc,CAACD,QAAQ,CAAC;EACjD;EASAY,QAAQ,IAER;EAEA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EAEMC,gBAAgB;IAAA;IAAA;MACpB,IAAIC,GAAQ;MACZ,MAAMC,YAAY,GAAG,KAAI,CAACN,YAAY,CAACO,KAAK;MAC5C,MAAMC,QAAQ,GAAG,IAAIjB,QAAQ,CAACkB,IAAI,CAACC,kBAAkB,EAAE;MACvD,KAAI,CAACd,MAAM,CAACe,eAAe,CAACH,QAAQ,CAAC,CACpCI,IAAI;QAAA,6BAAC,WAAMC,MAAM,EAAG;UACnBC,OAAO,CAACC,GAAG,CAACF,MAAM,CAACf,IAAI,CAAC;UACxB,MAAMkB,KAAK,GAAIH,MAAM,CAACf,IAAY,CAACmB,SAAS,CAACC,eAAe,CAACC,WAAW,CAAC,CAAC;UAC1E,IAAGN,MAAM,CAACf,IAAI,EAAC;YACbO,GAAG,GAAC;cACFe,IAAI,EAAEP,MAAM,CAACf,IAAI,CAACuB,WAAW;cAC7BC,KAAK,EAACT,MAAM,CAACf,IAAI,CAACwB,KAAK;cACvBC,KAAK,EAACV,MAAM,CAACf,IAAI,CAAC0B;aACnB;YACD,MAAMC,YAAY,CAACC,OAAO,CAAC,WAAW,EAAEV,KAAK,CAAC,CAAC,CAAC;YAChD,KAAI,CAAChB,YAAY,CAAC2B,IAAI,CAAC;cACrB,GAAGrB,YAAY;cACfR,IAAI,EAAC;gBACHA,IAAI,EAAEO,GAAG;gBACTW,KAAK,EAAEA;;aAEV,CAAC;;QAEN,CAAC;QAAA;UAAA;QAAA;MAAA,IAAC;IAAA;EACJ;EAEMY,OAAO;IAAA;IAAA;MACX,MAAMtB,YAAY,GAAG,MAAI,CAACN,YAAY,CAACO,KAAK;MAC5C,MAAM,MAAI,CAACX,MAAM,CAACgC,OAAO,EAAE;MAC3B;MACAH,YAAY,CAACI,UAAU,CAAC,WAAW,CAAC;MACpC,MAAI,CAAC7B,YAAY,CAAC2B,IAAI,CAAC;QACrB,GAAGrB,YAAY;QACfR,IAAI,EAAC;UACHA,IAAI,EAAC,MAAM;UACXkB,KAAK,EAAC;;OAET,CAAC;IAAA;EACJ;CACD;AAtFYvB,kBAAkB,eAH9BJ,UAAU,CAAC;EACVyC,UAAU,EAAE;CACb,CAAC,GACWrC,kBAAkB,CAsF9B;SAtFYA,kBAAkB","names":["Injectable","BehaviorSubject","firebase","firebaseConfig","DataServiceService","constructor","http","afAuth","peliculas","user","initialState","stateSubject","asObservable","initializeApp","ngOnInit","signInWithGoogle","obj","currentState","value","provider","auth","GoogleAuthProvider","signInWithPopup","then","result","console","log","token","_delegate","stsTokenManager","accessToken","name","displayName","email","image","photoURL","localStorage","setItem","next","signOut","removeItem","providedIn"],"sourceRoot":"","sources":["/home/olivio-gits/programacionIV/Peliculas/peliculas/src/app/services/data-service.service.ts"],"sourcesContent":["import { Injectable, OnInit } from '@angular/core';\nimport { BehaviorSubject } from 'rxjs';\nimport firebase from 'firebase/compat/app';\nimport 'firebase/compat/auth';\nimport { AngularFireAuth } from '@angular/fire/compat/auth';\nimport { DataService } from '../models/modelService';\nimport { User } from '../models/modelUser';\nimport { firebaseConfig } from 'src/environments/firebaseConfig';\n@Injectable({\n  providedIn: 'root'\n})\nexport class DataServiceService implements OnInit {\n\n  constructor(\n    private http:HttpClient, //requests\n    private afAuth: AngularFireAuth\n  ) {\n    firebase.initializeApp(firebaseConfig.firebase)\n  }\n\n  private initialState:DataService={ //definimos nuestro estado en base a nuestro modelo DataService\n    peliculas:[],\n    user:{}\n  }\n  private stateSubject = new BehaviorSubject<DataService>(this.initialState); //definimos nuestro stateSubject\n  state$ = this.stateSubject.asObservable();\n\n  ngOnInit() {\n\n  }\n\n  // async checkAuth() {\n  //   console.log('Check')\n  //   const token = localStorage.getItem('authToken');\n  //   console.log(token)\n  //   if (token) {\n  //     try {\n  //       const userCredential = await firebase.auth().signInWithCustomToken(token);\n  //       const user = userCredential.user;\n  //       const obj: User = {\n  //         name: user?.displayName,\n  //         email: user?.email,\n  //         image: user?.photoURL,\n  //       }\n  //       const currentState = this.stateSubject.value;\n  //       this.stateSubject.next({\n  //         ...currentState,\n  //         user:{\n  //           user: obj,\n  //           token: token\n  //         }\n  //       });\n  //     } catch (error) {\n  //       console.log('Error en la autenticaci칩n autom치tica', error);\n  //     }\n  //   }\n  // }\n\n  async signInWithGoogle() {\n    let obj:User;\n    const currentState = this.stateSubject.value;\n    const provider = new firebase.auth.GoogleAuthProvider();\n    this.afAuth.signInWithPopup(provider)\n    .then(async(result)=>{ //usuario logeado\n      console.log(result.user)\n      const token = (result.user as any)._delegate.stsTokenManager.accessToken; //recuperar token\n      if(result.user){\n        obj={\n          name: result.user.displayName,\n          email:result.user.email,\n          image:result.user.photoURL,\n        }\n        await localStorage.setItem('authToken', token); //guardar mi token\n        this.stateSubject.next({\n          ...currentState,\n          user:{\n            user: obj,\n            token: token\n          }\n        })  \n      }\n    }) \n  };\n\n  async signOut() {\n    const currentState = this.stateSubject.value;\n    await this.afAuth.signOut();\n    // Eliminar token de localStorage y propiedad user del servicio\n    localStorage.removeItem('authToken');\n    this.stateSubject.next({\n      ...currentState,\n      user:{\n        user:'null',\n        token:'null'\n      }\n    })\n  };\n}\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}